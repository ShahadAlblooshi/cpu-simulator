<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mano-style CPU Simulator</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 300px; margin-top: 20px; }
    th, td { border: 1px solid #333; padding: 5px; text-align: center; }
    tr.highlight { background-color: rgba(255, 255, 0, 0.3); }
    #cli { margin-top: 20px; }
    #cliInput { width: 200px; padding: 5px; }
    #cliBtn { padding: 5px 10px; }
    #output { margin-top: 10px; font-family: monospace; white-space: pre; }
  </style>
</head>
<body>

<h1>Mano-style CPU Simulator</h1>

<div id="cli">
  <input type="text" id="cliInput" placeholder="Enter command" />
  <button id="cliBtn">Run</button>
  <div id="output"></div>
</div>

<table id="memTable">
  <thead>
    <tr><th>Addr</th><th>Data</th></tr>
  </thead>
  <tbody>
    <!-- Memory rows will be rendered here -->
  </tbody>
</table>

<script>
  // Simulated memory (256 words for example)
  const MEM = new Array(256).fill(0).map((_, i) => i);

  // Render the memory table
  function renderMemTable() {
    const tableBody = document.querySelector('#memTable tbody');
    tableBody.innerHTML = '';
    for (let i = 0; i < MEM.length; i++) {
      const tr = document.createElement('tr');
      tr.setAttribute('data-addr', i);
      tr.innerHTML = `<td>${i.toString(16).padStart(2,'0').toUpperCase()}</td><td>${MEM[i].toString(16).padStart(4,'0').toUpperCase()}</td>`;
      tableBody.appendChild(tr);
    }
  }

  renderMemTable(); // initial render

  // CLI command handler
  document.getElementById('cliBtn').addEventListener('click', () => {
    const cmdInput = document.getElementById('cliInput').value.trim().toLowerCase();
    const outputDiv = document.getElementById('output');
    const memTable = document.getElementById('memTable');

    // Remove previous highlights
    memTable.querySelectorAll('tr').forEach(row => row.classList.remove('highlight'));

    if (cmdInput.startsWith('show mem')) {
      const parts = cmdInput.split(/\s+/);
      let start = 0;
      let end = 15;

      if (parts.length >= 3) start = parseInt(parts[2], 16);
      if (parts.length >= 4) end = parseInt(parts[3], 16);

      // Clamp values
      start = Math.max(0, start);
      end = Math.min(MEM.length - 1, end);

      // Highlight memory in table
      for (let i = start; i <= end; i++) {
        const row = memTable.querySelector(`tr[data-addr="${i}"]`);
        if (row) row.classList.add('highlight');
      }

      // Optional: show text output as well
      let textOutput = '';
      for (let i = start; i <= end; i++) {
        textOutput += `${i.toString(16).padStart(2,'0').toUpperCase()}: ${MEM[i].toString(16).padStart(4,'0').toUpperCase()}\n`;
      }
      outputDiv.textContent = textOutput;

    } else {
      outputDiv.textContent = `Unknown command: ${cmdInput}`;
    }
  });
</script>

</body>
</html>
